{% extends 'backend/template.html' %} {% block title %} Manajemen Data Admin {%
endblock %} {% block content %}
<div class="pagetitle">
  <h1>Data Admin</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{{ url_for('admin.dashboard') }}">Home</a>
      </li>
      <li class="breadcrumb-item">Manajemen</li>
      <li class="breadcrumb-item active">Data Admin</li>
    </ol>
  </nav>
</div>
<!-- End Page Title -->

<section class="section">
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Daftar Admin</h5>

          {% with messages = get_flashed_messages(with_categories=true) %} {% if
          messages %} {% for category, message in messages %}
          <div
            class="alert alert-{{ category }} alert-dismissible fade show"
            role="alert"
          >
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close"
            ></button>
          </div>
          {% endfor %} {% endif %} {% endwith %}

          <a
            href="{{ url_for('admin.tambah_admin') }}"
            class="btn btn-primary mb-3"
            style="border-radius: 50px"
            ><i class="bi bi-plus-circle"></i> Tambah Admin Baru</a
          >

          <table class="table">
            <thead>
              <tr>
                <th scope="col">No</th>
                <th scope="col">Nama</th>
                <th scope="col">Email</th>
                <th scope="col">No. HP</th>
                <th scope="col" width="15%">Aksi</th>
              </tr>
            </thead>
            <tbody>
              {% if admins %} {% for admin in admins %}
              <tr>
                <th scope="row">{{ loop.index }}</th>
                <td>{{ admin.nama }}</td>
                <td>{{ admin.email }}</td>
                <td>{{ admin.no_hp or '-' }}</td>
                <td>
                  <!-- Tombol Edit dengan Ikon -->
                  <a
                    href="{{ url_for('admin.edit_admin', admin_id=admin.id) }}"
                    class="btn btn-sm btn-warning"
                    title="Edit"
                    ><i class="bi bi-pencil-square"></i
                  ></a>

                  <!-- Tombol Hapus hanya muncul jika bukan admin yang sedang login -->
                  {% if current_user.id != admin.id %}
                  <form
                    id="form-hapus-admin-{{ admin.id }}"
                    method="POST"
                    action="{{ url_for('admin.hapus_admin', admin_id=admin.id) }}"
                    style="display: inline"
                  >
                    <button
                      type="button"
                      class="btn btn-sm btn-danger btn-hapus-admin"
                      data-id="{{ admin.id }}"
                      title="Hapus"
                    >
                      <i class="bi bi-trash"></i>
                    </button>
                  </form>
                  {% endif %}
                </td>
              </tr>
              {% endfor %} {% else %}
              <tr>
                <td colspan="5" class="text-center">Belum ada data admin.</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const deleteButtons = document.querySelectorAll(".btn-hapus-admin");

    deleteButtons.forEach((button) => {
      button.addEventListener("click", function (event) {
        event.preventDefault();

        const adminId = this.getAttribute("data-id");
        const form = document.getElementById("form-hapus-admin-" + adminId);

        Swal.fire({
          title: "Anda Yakin?",
          text: "Data admin ini akan dihapus secara permanen.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#3085d6",
          confirmButtonText: "Ya, Hapus!",
          cancelButtonText: "Batal",
        }).then((result) => {
          if (result.isConfirmed) {
            form.submit();
          }
        });
      });
    });
  });
</script>
{% endblock %}
